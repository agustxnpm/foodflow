#!/bin/bash
DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

echo "Buscando JAR desde: $DIR"

# === Buscar JAR ===
if [ -f "$DIR/backend.jar" ]; then
    JAR_PATH="$DIR/backend.jar"
    echo "JAR encontrado en: $JAR_PATH"
elif [ -f "$DIR/../binaries/backend.jar" ]; then
    JAR_PATH="$DIR/../binaries/backend.jar"
    echo "JAR encontrado en: $JAR_PATH"
elif [ -f "$DIR/../../binaries/backend.jar" ]; then
    JAR_PATH="$DIR/../../binaries/backend.jar"
    echo "JAR encontrado en: $JAR_PATH"
else
    echo "Error: No se encuentra backend.jar"
    echo "IntentÃ© en:"
    echo "  - $DIR/backend.jar"
    echo "  - $DIR/../binaries/backend.jar"
    echo "  - $DIR/../../binaries/backend.jar"
    ls -la "$DIR" || true
    exit 1
fi

# === Buscar Java embebido (JRE custom via jlink) ===
if [ -x "$DIR/../jre/bin/java" ]; then
    JAVA_CMD="$DIR/../jre/bin/java"
    echo "Usando JRE embebido: $JAVA_CMD"
elif [ -x "$DIR/jre/bin/java" ]; then
    JAVA_CMD="$DIR/jre/bin/java"
    echo "Usando JRE embebido: $JAVA_CMD"
elif command -v java &>/dev/null; then
    JAVA_CMD="java"
    echo "Usando Java del sistema"
else
    echo "Error: No se encuentra Java embebido ni Java del sistema"
    exit 1
fi

"$JAVA_CMD" -Dspring.profiles.active=offline -jar "$JAR_PATH"
